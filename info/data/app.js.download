angular.module('Triangulator', ['angularFileUpload']);

app = angular.module('Triangulator');
function dataURLtoFile(dataurl, filename) {

    var arr = dataurl.split(','),
        mime = arr[0].match(/:(.*?);/)[1],
        bstr = atob(arr[1]), 
        n = bstr.length, 
        u8arr = new Uint8Array(n);
        
    while(n--){
        u8arr[n] = bstr.charCodeAt(n);
    }
    
    return new File([u8arr], filename, {type:mime});
}

app.controller('MainCtrl', function($scope, $element, $attrs) {
    var elem = document.getElementById('delaunay');
    $scope.original = {
        image: 'img/base.jpg',
        algorithm: 'yape06',
        yapeLaplacian: 50,
        yapeMineigen: 120,
        yapeRadius: 2,
        fastTreshold: 15,
        rawImage: null,
        size: 720
    };

    $scope.process = angular.copy($scope.original);

    $scope.$watch('process', function(newVal, oldVal) {
        $scope.update(newVal);
    }, true);

    $scope.restart = function restart() {
        $scope.process = angular.copy($scope.original);
    };

    $scope.update = function update(process) {
        triangulator(elem, $scope.process);
        var dataURL = elem.toDataURL();
        window.flutter_inappwebview
                    .callHandler('handlerFooWithArgs', dataURL);
    };
    $scope.onBase64 = function(base64Image) {
        var file = dataURLtoFile(base64Image,'image.png');
        $scope.process.rawImage = file;
        triangulator(elem, $scope.process);
         var dataURL = elem.toDataURL();
        window.flutter_inappwebview
                    .callHandler('handlerFooWithArgs', dataURL);
    }
    $scope.onFileSelect = function($files) {
        // should remove this function
    };
    $scope.myFunction = function() {
      
    };
    
    triangulator(elem, $scope.process);
});



